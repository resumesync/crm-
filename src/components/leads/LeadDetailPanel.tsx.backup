import { Lead, STATUS_CONFIG, SERVICE_CONFIG, Activity, CallRecord, MessageRecord, FollowUp, FollowUpPriority } from '@/types/crm';
import { mockUsers, mockQuickMessages, getLeadActivities, getLeadCalls, getLeadMessages, getLeadFollowUps } from '@/data/mockData';
import { cn } from '@/lib/utils';
import { format, formatDistanceToNow } from 'date-fns';
import {
  X,
  Phone,
  Mail,
  MapPin,
  Calendar,
  MessageCircle,
  Send,
  Plus,
  Clock,
  User,
  PhoneCall,
  PhoneIncoming,
  PhoneOutgoing,
  PhoneMissed,
  MessageSquare,
  CheckCheck,
  Check,
  AlertCircle,
  CalendarClock,
  History,
  Bell,
  ArrowUpRight,
  ArrowDownLeft,
  Megaphone,
  Globe,
} from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { useState } from 'react';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Badge } from '@/components/ui/badge';
import { ScrollArea } from '@/components/ui/scroll-area';
import { toast } from '@/hooks/use-toast';

interface LeadDetailPanelProps {
  lead: Lead;
  onClose: () => void;
}

const PRIORITY_CONFIG: Record<FollowUpPriority, { label: string; className: string }> = {
  low: { label: 'Low', className: 'bg-secondary text-secondary-foreground' },
  medium: { label: 'Medium', className: 'bg-amber-500/20 text-amber-600' },
  high: { label: 'High', className: 'bg-orange-500/20 text-orange-600' },
  urgent: { label: 'Urgent', className: 'bg-destructive/20 text-destructive' },
};

export function LeadDetailPanel({ lead, onClose }: LeadDetailPanelProps) {
  const [newNote, setNewNote] = useState('');
  const [activeTab, setActiveTab] = useState('overview');

  const assignedUser = mockUsers.find((u) => u.id === lead.assignedTo);
  const activities = getLeadActivities(lead.id);
  const calls = getLeadCalls(lead.id);
  const messages = getLeadMessages(lead.id);
  const followUps = getLeadFollowUps(lead.id);

  const openWhatsApp = (message: string) => {
    const filledMessage = message
      .replace('{{name}}', lead.name.split(' ')[0])
      .replace('{{service}}', SERVICE_CONFIG[lead.service].label)
      .replace('{{clinic_name}}', lead.clinicName);
    const encoded = encodeURIComponent(filledMessage);
    window.open(`https://wa.me/${lead.phone.replace(/[^0-9]/g, '')}?text=${encoded}`, '_blank');
  };

  const formatDuration = (seconds?: number) => {
    if (!seconds) return '-';
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  };

  const getCallIcon = (call: CallRecord) => {
    if (call.status === 'missed' || call.status === 'no_answer') {
      return <PhoneMissed className="h-4 w-4 text-destructive" />;
    }
    if (call.direction === 'inbound') {
      return <PhoneIncoming className="h-4 w-4 text-green-500" />;
    }
    return <PhoneOutgoing className="h-4 w-4 text-primary" />;
  };

  const getMessageStatusIcon = (status: MessageRecord['status']) => {
    switch (status) {
      case 'read':
        return <CheckCheck className="h-3.5 w-3.5 text-primary" />;
      case 'delivered':
        return <CheckCheck className="h-3.5 w-3.5 text-muted-foreground" />;
      case 'sent':
        return <Check className="h-3.5 w-3.5 text-muted-foreground" />;
      case 'failed':
        return <AlertCircle className="h-3.5 w-3.5 text-destructive" />;
    }
  };

  const getChannelIcon = (channel: MessageRecord['channel']) => {
    switch (channel) {
      case 'whatsapp':
        return <MessageCircle className="h-4 w-4 text-whatsapp" />;
      case 'sms':
        return <MessageSquare className="h-4 w-4 text-primary" />;
      case 'email':
        return <Mail className="h-4 w-4 text-primary" />;
    }
  };

  const getActivityIcon = (type: Activity['type']) => {
    switch (type) {
      case 'call':
        return <PhoneCall className="h-4 w-4" />;
      case 'message':
        return <MessageCircle className="h-4 w-4" />;
      case 'email':
        return <Mail className="h-4 w-4" />;
      case 'note':
        return <MessageSquare className="h-4 w-4" />;
      case 'status_change':
        return <History className="h-4 w-4" />;
      case 'meeting':
        return <Calendar className="h-4 w-4" />;
      case 'follow_up':
        return <Bell className="h-4 w-4" />;
    }
  };

  // Stats for the lead
  const stats = {
    totalCalls: calls.length,
    completedCalls: calls.filter(c => c.status === 'completed').length,
    totalMessages: messages.length,
    pendingFollowUps: followUps.filter(f => f.status === 'pending' || f.status === 'overdue').length,
  };

  return (
    <div className="animate-slide-up w-[420px] overflow-hidden rounded-xl border border-border bg-card shadow-elevated lg:block">
      {/* Header */}
      <div className="flex items-center justify-between border-b border-border bg-secondary/30 px-4 py-3">
        <h3 className="font-semibold text-foreground">Lead Details</h3>
        <Button variant="ghost" size="icon-sm" onClick={onClose}>
          <X className="h-4 w-4" />
        </Button>
      </div>

      {/* Lead Info Header */}
      <div className="border-b border-border p-4">
        <div className="flex items-center gap-3">
          <div className="flex h-12 w-12 items-center justify-center rounded-full bg-primary/10">
            <span className="text-lg font-bold text-primary">
              {lead.name.split(' ').map((n) => n[0]).join('').slice(0, 2)}
            </span>
          </div>
          <div className="flex-1">
            <h4 className="font-semibold text-foreground">{lead.name}</h4>
            <p className="text-sm text-muted-foreground">{lead.clinicName}</p>
          </div>
        </div>

        {/* Quick Stats */}
        <div className="mt-4 grid grid-cols-4 gap-2">
          <div className="rounded-lg bg-secondary/50 p-2 text-center">
            <p className="text-lg font-bold text-foreground">{stats.totalCalls}</p>
            <p className="text-xs text-muted-foreground">Calls</p>
          </div>
          <div className="rounded-lg bg-secondary/50 p-2 text-center">
            <p className="text-lg font-bold text-foreground">{stats.totalMessages}</p>
            <p className="text-xs text-muted-foreground">Messages</p>
          </div>
          <div className="rounded-lg bg-secondary/50 p-2 text-center">
            <p className="text-lg font-bold text-foreground">{activities.length}</p>
            <p className="text-xs text-muted-foreground">Activities</p>
          </div>
          <div className="rounded-lg bg-secondary/50 p-2 text-center">
            <p className="text-lg font-bold text-foreground">{stats.pendingFollowUps}</p>
            <p className="text-xs text-muted-foreground">Follow-ups</p>
          </div>
        </div>

        {/* Quick Actions */}
        <div className="mt-4 flex gap-2">
          <Button
            variant="outline"
            size="sm"
            className="flex-1"
            onClick={() => (window.location.href = `tel:${lead.phone}`)}
          >
            <Phone className="h-4 w-4" />
            Call
          </Button>
          <Button
            variant="whatsapp"
            size="sm"
            className="flex-1"
            onClick={() => openWhatsApp(`Hi ${lead.name.split(' ')[0]}, `)}
          >
            <MessageCircle className="h-4 w-4" />
            WhatsApp
          </Button>
        </div>
      </div>

      {/* Tabs */}
      <Tabs value={activeTab} onValueChange={setActiveTab} className="flex-1">
        <TabsList className="grid w-full grid-cols-5 gap-0 bg-secondary/30 p-1">
          <TabsTrigger value="overview" className="text-xs">Overview</TabsTrigger>
          <TabsTrigger value="activity" className="text-xs">Activity</TabsTrigger>
          <TabsTrigger value="calls" className="text-xs">Calls</TabsTrigger>
          <TabsTrigger value="messages" className="text-xs">Messages</TabsTrigger>
          <TabsTrigger value="followups" className="text-xs">Follow-ups</TabsTrigger>
          {(lead.source === 'meta' || lead.metaData) && (
            <TabsTrigger value="meta" className="text-xs">Meta Data</TabsTrigger>
          )}
          {(lead.source === 'google' || lead.googleData) && (
            <TabsTrigger value="google" className="text-xs">Google Ads</TabsTrigger>
          )}
        </TabsList>

        <ScrollArea className="h-[calc(100vh-380px)]">
          {/* Overview Tab */}
          <TabsContent value="overview" className="mt-0 p-4">
            <div className="space-y-4">
              {/* Contact Info */}
              <div className="space-y-2">
                <h5 className="text-xs font-semibold uppercase text-muted-foreground">Contact Info</h5>
                <div className="space-y-2">
                  <div className="flex items-center gap-2 text-sm">
                    <Phone className="h-4 w-4 text-muted-foreground" />
                    <span className="text-foreground">{lead.phone}</span>
                  </div>
                  {lead.alternatePhone && (
                    <div className="flex items-center gap-2 text-sm">
                      <Phone className="h-4 w-4 text-muted-foreground" />
                      <span className="text-foreground">{lead.alternatePhone}</span>
                      <Badge variant="outline" className="text-[10px]">Alt</Badge>
                    </div>
                  )}
                  {lead.whatsappNumber && (
                    <div className="flex items-center gap-2 text-sm">
                      <MessageCircle className="h-4 w-4 text-whatsapp" />
                      <span className="text-foreground">{lead.whatsappNumber}</span>
                      <Badge variant="outline" className="text-[10px]">WhatsApp</Badge>
                    </div>
                  )}
                  {lead.email && (
                    <div className="flex items-center gap-2 text-sm">
                      <Mail className="h-4 w-4 text-muted-foreground" />
                      <span className="text-foreground">{lead.email}</span>
                    </div>
                  )}
                </div>
              </div>

              {/* Location Info */}
              <div className="space-y-2">
                <h5 className="text-xs font-semibold uppercase text-muted-foreground">Location</h5>
                <div className="space-y-2">
                  <div className="flex items-center gap-2 text-sm">
                    <MapPin className="h-4 w-4 text-muted-foreground" />
                    <span className="text-foreground">{lead.city}{lead.state ? `, ${lead.state}` : ''}</span>
                  </div>
                  {lead.pincode && (
                    <div className="flex items-center gap-2 text-sm">
                      <span className="text-xs text-muted-foreground">PIN:</span>
                      <span className="text-foreground">{lead.pincode}</span>
                    </div>
                  )}
                  {lead.address && (
                    <div className="flex items-start gap-2 text-sm">
                      <MapPin className="h-4 w-4 text-muted-foreground mt-0.5" />
                      <span className="text-foreground">{lead.address}</span>
                    </div>
                  )}
                </div>
              </div>

              {/* Personal Details */}
              <div className="space-y-2">
                <h5 className="text-xs font-semibold uppercase text-muted-foreground">Personal Details</h5>
                <div className="grid grid-cols-2 gap-2">
                  {lead.age && (
                    <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                      <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Age</label>
                      <p className="text-sm font-medium text-foreground">{lead.age} years</p>
                    </div>
                  )}
                  {lead.gender && (
                    <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                      <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Gender</label>
                      <p className="text-sm font-medium text-foreground capitalize">{lead.gender}</p>
                    </div>
                  )}
                  {lead.birthday && (
                    <div className="rounded-lg border border-border/50 bg-secondary/20 p-2 col-span-2">
                      <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Birthday</label>
                      <div className="flex items-center gap-2">
                        <Calendar className="h-3.5 w-3.5 text-muted-foreground" />
                        <p className="text-sm font-medium text-foreground">{format(lead.birthday, 'PPP')}</p>
                      </div>
                    </div>
                  )}
                </div>
              </div>

              {/* Professional Details */}
              {(lead.occupation || lead.companyName) && (
                <div className="space-y-2">
                  <h5 className="text-xs font-semibold uppercase text-muted-foreground">Professional Info</h5>
                  <div className="space-y-2">
                    {lead.occupation && (
                      <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                        <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Occupation</label>
                        <p className="text-sm font-medium text-foreground">{lead.occupation}</p>
                      </div>
                    )}
                    {lead.companyName && (
                      <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                        <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Company</label>
                        <p className="text-sm font-medium text-foreground">{lead.companyName}</p>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Lead Preferences */}
              <div className="space-y-2">
                <h5 className="text-xs font-semibold uppercase text-muted-foreground">Preferences</h5>
                <div className="grid gap-2">
                  {lead.bestTimeToCall && (
                    <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                      <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Best Time to Call</label>
                      <p className="text-sm font-medium text-foreground">{lead.bestTimeToCall}</p>
                    </div>
                  )}
                  {lead.languagePreference && (
                    <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                      <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Language</label>
                      <p className="text-sm font-medium text-foreground">{lead.languagePreference}</p>
                    </div>
                  )}
                  {lead.budget && (
                    <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                      <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Budget</label>
                      <p className="text-sm font-medium text-foreground">{lead.budget}</p>
                    </div>
                  )}
                  {lead.urgency && (
                    <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                      <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Urgency</label>
                      <Badge variant={lead.urgency === 'immediate' ? 'destructive' : 'secondary'} className="capitalize">
                        {lead.urgency.replace('_', ' ')}
                      </Badge>
                    </div>
                  )}
                  {lead.referredBy && (
                    <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                      <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Referred By</label>
                      <p className="text-sm font-medium text-foreground">{lead.referredBy}</p>
                    </div>
                  )}
                  {lead.previousClinicVisited !== undefined && (
                    <div className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                      <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Previous Clinic Visit</label>
                      <p className="text-sm font-medium text-foreground">{lead.previousClinicVisited ? 'Yes' : 'No'}</p>
                    </div>
                  )}
                </div>
              </div>

              {/* Created Info */}
              <div className="rounded-lg border border-border/50 bg-secondary/10 p-2">
                <div className="flex items-center gap-2 text-xs text-muted-foreground">
                  <Clock className="h-3.5 w-3.5" />
                  <span>Created: {format(lead.createdAt, 'PPP')}</span>
                </div>
              </div>
              <SelectValue />
            </SelectTrigger>
            <SelectContent>
              {mockUsers.map((user) => (
                <SelectItem key={user.id} value={user.id}>
                  {user.name}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
    </div>

            {/* Quick Messages */ }
  <div>
    <h5 className="mb-2 text-xs font-semibold uppercase text-muted-foreground">Quick Messages</h5>
    <div className="space-y-2">
      {mockQuickMessages.slice(0, 3).map((msg) => (
        <button
          key={msg.id}
          onClick={() => openWhatsApp(msg.content)}
          className="flex w-full items-center gap-2 rounded-lg border border-border/50 bg-secondary/30 px-3 py-2 text-left text-sm transition-all hover:bg-secondary/50"
        >
          <Send className="h-3.5 w-3.5 text-whatsapp" />
          <span className="flex-1 truncate text-foreground">{msg.title}</span>
        </button>
      ))}
    </div>
  </div>

  {/* Notes */ }
  <div>
    <h5 className="mb-2 text-xs font-semibold uppercase text-muted-foreground">Notes</h5>
    <Textarea
      value={newNote}
      onChange={(e) => setNewNote(e.target.value)}
      placeholder="Add a note..."
      className="min-h-[60px] resize-none"
    />
    <Button
      size="sm"
      className="mt-2 w-full"
      disabled={!newNote.trim()}
      onClick={() => {
        toast({ title: "Note Added", description: "Your note has been saved." });
        setNewNote('');
      }}
    >
      <Plus className="h-4 w-4" />
      Add Note
    </Button>

    {lead.notes.length > 0 && (
      <div className="mt-3 space-y-2">
        {lead.notes.slice(0, 2).map((note) => {
          const author = mockUsers.find((u) => u.id === note.createdBy);
          return (
            <div key={note.id} className="rounded-lg border border-border/50 bg-secondary/20 p-2">
              <p className="text-xs text-foreground">{note.content}</p>
              <div className="mt-1 flex items-center gap-1 text-[10px] text-muted-foreground">
                <User className="h-3 w-3" />
                <span>{author?.name}</span>
                <span className="mx-1">•</span>
                <span>{format(note.createdAt, 'PP')}</span>
              </div>
            </div>
          );
        })}
      </div>
    )}
  </div>
          </div >
        </TabsContent >

    {/* Activity Timeline Tab */ }
    < TabsContent value = "activity" className = "mt-0 p-4" >
      <div className="relative">
        <div className="absolute left-4 top-0 h-full w-px bg-border" />
        <div className="space-y-4">
          {activities.length === 0 ? (
            <p className="py-8 text-center text-sm text-muted-foreground">No activities yet</p>
          ) : (
            activities.map((activity) => {
              const author = mockUsers.find((u) => u.id === activity.createdBy);
              return (
                <div key={activity.id} className="relative pl-10">
                  <div className="absolute left-2 top-1 flex h-5 w-5 items-center justify-center rounded-full bg-secondary text-muted-foreground">
                    {getActivityIcon(activity.type)}
                  </div>
                  <div className="rounded-lg border border-border/50 bg-secondary/20 p-3">
                    <div className="flex items-start justify-between">
                      <h6 className="text-sm font-medium text-foreground">{activity.title}</h6>
                      <span className="text-[10px] text-muted-foreground">
                        {formatDistanceToNow(activity.createdAt, { addSuffix: true })}
                      </span>
                    </div>
                    {activity.description && (
                      <p className="mt-1 text-xs text-muted-foreground">{activity.description}</p>
                    )}
                    <div className="mt-2 flex items-center gap-1 text-[10px] text-muted-foreground">
                      <User className="h-3 w-3" />
                      <span>{author?.name}</span>
                    </div>
                  </div>
                </div>
              );
            })
          )}
        </div>
      </div>
        </TabsContent >

    {/* Calls Tab */ }
    < TabsContent value = "calls" className = "mt-0 p-4" >
          <div className="mb-4 flex items-center justify-between">
            <h5 className="text-xs font-semibold uppercase text-muted-foreground">Call History</h5>
            <Button size="sm" variant="outline" onClick={() => toast({ title: "Log Call", description: "Call logging form coming soon!" })}>
              <Plus className="h-3.5 w-3.5" />
              Log Call
            </Button>
          </div>

          <div className="space-y-3">
            {calls.length === 0 ? (
              <p className="py-8 text-center text-sm text-muted-foreground">No calls recorded</p>
            ) : (
              calls.map((call) => {
                const caller = mockUsers.find((u) => u.id === call.createdBy);
                return (
                  <div key={call.id} className="rounded-lg border border-border/50 bg-secondary/20 p-3">
                    <div className="flex items-start gap-3">
                      <div className={cn(
                        'flex h-9 w-9 items-center justify-center rounded-full',
                        call.status === 'completed' ? 'bg-green-500/10' : 'bg-destructive/10'
                      )}>
                        {getCallIcon(call)}
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <span className="text-sm font-medium text-foreground">
                              {call.direction === 'inbound' ? 'Incoming' : 'Outgoing'} Call
                            </span>
                            <Badge variant={call.status === 'completed' ? 'default' : 'destructive'} className="text-[10px]">
                              {call.status.replace('_', ' ')}
                            </Badge>
                          </div>
                          <span className="text-xs text-muted-foreground">
                            {formatDuration(call.duration)}
                          </span>
                        </div>
                        <div className="mt-1 flex items-center gap-2 text-xs text-muted-foreground">
                          <Clock className="h-3 w-3" />
                          <span>{format(call.createdAt, 'PPp')}</span>
                        </div>
                        {call.notes && (
                          <p className="mt-2 text-xs text-muted-foreground">{call.notes}</p>
                        )}
                        <div className="mt-2 flex items-center gap-1 text-[10px] text-muted-foreground">
                          <User className="h-3 w-3" />
                          <span>{caller?.name}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })
            )}
          </div>
        </TabsContent >

    {/* Messages Tab */ }
    < TabsContent value = "messages" className = "mt-0 p-4" >
          <div className="mb-4 flex items-center justify-between">
            <h5 className="text-xs font-semibold uppercase text-muted-foreground">Message History</h5>
            <Button size="sm" variant="outline" onClick={() => toast({ title: "Send Message", description: "Message composer coming soon!" })}>
              <Plus className="h-3.5 w-3.5" />
              Send Message
            </Button>
          </div>

          <div className="space-y-3">
            {messages.length === 0 ? (
              <p className="py-8 text-center text-sm text-muted-foreground">No messages yet</p>
            ) : (
              messages.map((msg) => {
                const sender = mockUsers.find((u) => u.id === msg.createdBy);
                return (
                  <div key={msg.id} className={cn(
                    'rounded-lg border border-border/50 p-3',
                    msg.direction === 'outbound' ? 'bg-primary/5 ml-4' : 'bg-secondary/20 mr-4'
                  )}>
                    <div className="flex items-start gap-2">
                      <div className="flex h-7 w-7 items-center justify-center rounded-full bg-secondary">
                        {getChannelIcon(msg.channel)}
                      </div>
                      <div className="flex-1">
                        <div className="flex items-center gap-2">
                          <span className="text-xs font-medium capitalize text-foreground">{msg.channel}</span>
                          <span className="flex items-center gap-1 text-[10px] text-muted-foreground">
                            {msg.direction === 'outbound' ? (
                              <ArrowUpRight className="h-3 w-3" />
                            ) : (
                              <ArrowDownLeft className="h-3 w-3" />
                            )}
                            {msg.direction}
                          </span>
                          {getMessageStatusIcon(msg.status)}
                        </div>
                        <p className="mt-1 text-xs text-foreground">{msg.content}</p>
                        <div className="mt-2 flex items-center gap-2 text-[10px] text-muted-foreground">
                          <Clock className="h-3 w-3" />
                          <span>{format(msg.createdAt, 'PPp')}</span>
                          {sender && (
                            <>
                              <span className="mx-1">•</span>
                              <User className="h-3 w-3" />
                              <span>{sender.name}</span>
                            </>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })
            )}
          </div>
        </TabsContent >

    {/* Follow-ups Tab */ }
    < TabsContent value = "followups" className = "mt-0 p-4" >
          <div className="mb-4 flex items-center justify-between">
            <h5 className="text-xs font-semibold uppercase text-muted-foreground">Follow-ups</h5>
            <Button size="sm" variant="outline" onClick={() => toast({ title: "Add Follow-up", description: "Follow-up scheduler coming soon!" })}>
              <Plus className="h-3.5 w-3.5" />
              Add Follow-up
            </Button>
          </div>

          <div className="space-y-3">
            {followUps.length === 0 ? (
              <p className="py-8 text-center text-sm text-muted-foreground">No follow-ups scheduled</p>
            ) : (
              followUps.map((followUp) => {
                const creator = mockUsers.find((u) => u.id === followUp.createdBy);
                const isOverdue = followUp.status === 'overdue';
                const isPending = followUp.status === 'pending';

                return (
                  <div key={followUp.id} className={cn(
                    'rounded-lg border p-3',
                    isOverdue ? 'border-destructive/50 bg-destructive/5' :
                      isPending ? 'border-primary/50 bg-primary/5' :
                        'border-border/50 bg-secondary/20'
                  )}>
                    <div className="flex items-start gap-3">
                      <div className={cn(
                        'flex h-9 w-9 items-center justify-center rounded-full',
                        isOverdue ? 'bg-destructive/10 text-destructive' :
                          isPending ? 'bg-primary/10 text-primary' :
                            'bg-secondary text-muted-foreground'
                      )}>
                        <CalendarClock className="h-4 w-4" />
                      </div>
                      <div className="flex-1">
                        <div className="flex items-start justify-between gap-2">
                          <h6 className="text-sm font-medium text-foreground">{followUp.title}</h6>
                          <Badge className={cn('text-[10px]', PRIORITY_CONFIG[followUp.priority].className)}>
                            {PRIORITY_CONFIG[followUp.priority].label}
                          </Badge>
                        </div>

                        {followUp.description && (
                          <p className="mt-1 text-xs text-muted-foreground">{followUp.description}</p>
                        )}

                        <div className="mt-2 flex flex-wrap items-center gap-2">
                          <Badge variant="outline" className="text-[10px] capitalize">
                            {followUp.type}
                          </Badge>
                          <Badge
                            variant={isOverdue ? 'destructive' : isPending ? 'default' : 'secondary'}
                            className="text-[10px] capitalize"
                          >
                            {followUp.status}
                          </Badge>
                        </div>

                        <div className="mt-2 flex items-center gap-2 text-[10px] text-muted-foreground">
                          <Calendar className="h-3 w-3" />
                          <span>
                            {isOverdue ? 'Was due' : 'Due'}: {format(followUp.scheduledFor, 'PPp')}
                          </span>
                        </div>

                        <div className="mt-1 flex items-center gap-1 text-[10px] text-muted-foreground">
                          <User className="h-3 w-3" />
                          <span>Created by {creator?.name}</span>
                        </div>

                        {isPending && (
                          <div className="mt-3 flex gap-2">
                            <Button size="sm" variant="outline" className="h-7 text-xs" onClick={() => toast({ title: "Follow-up Completed", description: `"${followUp.title}" marked as complete.` })}>
                              Complete
                            </Button>
                            <Button size="sm" variant="ghost" className="h-7 text-xs" onClick={() => toast({ title: "Reschedule", description: "Reschedule dialog coming soon!" })}>
                              Reschedule
                            </Button>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                );
              })
            )}
          </div>
        </TabsContent >

    {/* Meta Data Tab */ }
  {
    (lead.source === 'meta' || lead.metaData) && (
      <TabsContent value="meta" className="mt-0 p-4">
        <div className="space-y-4">
          <div className="flex items-center gap-2 rounded-lg border border-primary/20 bg-primary/5 p-3">
            <div className="flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-primary">
              <Megaphone className="h-4 w-4" />
            </div>
            <div className="flex-1">
              <h5 className="text-sm font-medium text-foreground">Meta Lead Ad</h5>
              <p className="text-xs text-muted-foreground">
                Captured via {lead.metaData?.platform === 'ig' ? 'Instagram' : 'Facebook'}
              </p>
            </div>
            <Badge variant="outline" className="border-primary/20 bg-primary/5 text-primary">
              Verified
            </Badge>
          </div>

          <div className="grid gap-3">
            <div className="rounded-lg border border-border/50 bg-card p-3 shadow-sm">
              <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Campaign</label>
              <p className="mt-1 font-medium text-foreground">{lead.metaData?.campaignName || 'N/A'}</p>
              <p className="text-[10px] text-muted-foreground font-mono mt-0.5">ID: {lead.metaData?.campaignId || '-'}</p>
            </div>

            <div className="rounded-lg border border-border/50 bg-card p-3 shadow-sm">
              <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Ad Set</label>
              <p className="mt-1 font-medium text-foreground">{lead.metaData?.adSetName || 'N/A'}</p>
              <p className="text-[10px] text-muted-foreground font-mono mt-0.5">ID: {lead.metaData?.adSetId || '-'}</p>
            </div>

            <div className="rounded-lg border border-border/50 bg-card p-3 shadow-sm">
              <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Ad</label>
              <p className="mt-1 font-medium text-foreground">{lead.metaData?.adName || 'N/A'}</p>
              <p className="text-[10px] text-muted-foreground font-mono mt-0.5">ID: {lead.metaData?.adId || '-'}</p>
            </div>

            <div className="rounded-lg border border-border/50 bg-card p-3 shadow-sm">
              <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Form</label>
              <p className="mt-1 font-medium text-foreground">{lead.metaData?.formName || 'N/A'}</p>
              <p className="text-[10px] text-muted-foreground font-mono mt-0.5">ID: {lead.metaData?.formId || '-'}</p>
            </div>
          </div>

          {/* Custom Form Fields */}
          {lead.metaData?.customFields && Object.keys(lead.metaData.customFields).length > 0 && (
            <div className="space-y-2">
              <h6 className="text-xs font-semibold uppercase text-muted-foreground">Custom Form Fields</h6>
              <div className="grid gap-2">
                {Object.entries(lead.metaData.customFields).map(([key, value]) => (
                  <div key={key} className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                    <label className="text-[10px] font-medium uppercase tracking-wider text-muted-foreground">{key}</label>
                    <p className="mt-0.5 text-sm text-foreground">{value}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </TabsContent>
    )
  }

  {/* Google Ads Tab */ }
  {
    (lead.source === 'google' || lead.googleData) && (
      <TabsContent value="google" className="mt-0 p-4">
        <div className="space-y-4">
          <div className="flex items-center gap-2 rounded-lg border border-primary/20 bg-primary/5 p-3">
            <div className="flex h-8 w-8 items-center justify-center rounded-full bg-primary/10 text-primary">
              <Globe className="h-4 w-4" />
            </div>
            <div className="flex-1">
              <h5 className="text-sm font-medium text-foreground">Google Ads</h5>
              <p className="text-xs text-muted-foreground">
                Captured via search campaign
              </p>
            </div>
            <Badge variant="outline" className="border-primary/20 bg-primary/5 text-primary">
              Verified
            </Badge>
          </div>

          <div className="grid gap-3">
            <div className="rounded-lg border border-border/50 bg-card p-3 shadow-sm">
              <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Campaign</label>
              <p className="mt-1 font-medium text-foreground">{lead.googleData?.campaignName || 'N/A'}</p>
              <p className="text-[10px] text-muted-foreground font-mono mt-0.5">ID: {lead.googleData?.campaignId || '-'}</p>
            </div>

            <div className="rounded-lg border border-border/50 bg-card p-3 shadow-sm">
              <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Ad Group</label>
              <p className="mt-1 font-medium text-foreground">{lead.googleData?.adGroupName || 'N/A'}</p>
              <p className="text-[10px] text-muted-foreground font-mono mt-0.5">ID: {lead.googleData?.adGroupId || '-'}</p>
            </div>

            <div className="rounded-lg border border-border/50 bg-card p-3 shadow-sm">
              <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Ad</label>
              <p className="mt-1 font-medium text-foreground">{lead.googleData?.adName || '-'}</p>
              <p className="text-[10px] text-muted-foreground font-mono mt-0.5">ID: {lead.googleData?.adId || '-'}</p>
            </div>

            <div className="rounded-lg border border-border/50 bg-card p-3 shadow-sm">
              <label className="text-[10px] uppercase tracking-wider text-muted-foreground">Keyword</label>
              <div className="mt-1 flex items-center gap-2">
                <span className="font-medium text-foreground">{lead.googleData?.keyword || 'N/A'}</span>
                {lead.googleData?.matchType && (
                  <Badge variant="secondary" className="text-[10px] capitalize">
                    {lead.googleData.matchType.toLowerCase()}
                  </Badge>
                )}
              </div>
            </div>
          </div>

          {/* Custom Form Fields */}
          {lead.googleData?.customFields && Object.keys(lead.googleData.customFields).length > 0 && (
            <div className="space-y-2">
              <h6 className="text-xs font-semibold uppercase text-muted-foreground">Custom Form Fields</h6>
              <div className="grid gap-2">
                {Object.entries(lead.googleData.customFields).map(([key, value]) => (
                  <div key={key} className="rounded-lg border border-border/50 bg-secondary/20 p-2">
                    <label className="text-[10px] font-medium uppercase tracking-wider text-muted-foreground">{key}</label>
                    <p className="mt-0.5 text-sm text-foreground">{value}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </TabsContent>
    )
  }
      </ScrollArea >
    </Tabs >
    </div >
  );
}